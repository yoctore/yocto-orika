"use strict";function Orkaisse(a){this.logger=a,this.version="1.0.13",this.endpoint="orkaisse/drive/api",this.state=!1,this.core=require("../core")(a),this.schema=require("./schema")(a),this.factory=require("./factory")(a)}var logger=require("yocto-logger"),_=require("lodash"),Q=require("q");Orkaisse.prototype.init=function(a){return this.core.init(a)},Orkaisse.prototype.isReady=function(){return this.state},Orkaisse.prototype.order=function(a){return this.process("order",null,a)},Orkaisse.prototype.prepare=function(a){return this.process("prepare","sale",a)},Orkaisse.prototype.paid=function(a){return this.process("paid","sale",a)},Orkaisse.prototype.cancel=function(a){return this.process("cancel","sale",a)},Orkaisse.prototype.build=function(a,b){return _.isFunction(this.factory[a])?this.factory[a](b):!1},Orkaisse.prototype.process=function(a,b,c){var d=Q.defer();return this.core.process(this.schema.get(a),b?[b,a].join("/"):a,this.endpoint,c).then(function(a){if(_.includes(this.schema.getStatusCodes(!0),a.status)&&0!==a.status&&2!==a.status){var b=102!==a.status?"error":"warning";this.logger[b](["[ Orkaisse.process ] - An error occured :",this.schema.getStatusCodesMessage(a.status)].join(" "))}d.resolve(a)}.bind(this))["catch"](function(a){d.reject(a)}),d.promise},module.exports=function(a){return(_.isUndefined(a)||_.isNull(a))&&(logger.warning(["[ YoctoOrika.Orkaisse.constructor ] -","Invalid logger given. Use internal logger"].join(" ")),a=logger),new Orkaisse(a)};